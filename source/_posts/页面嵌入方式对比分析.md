---
title: 页面嵌入方式对比分析
categories: 博客
tags: [hexo,iframe,页面嵌入]
date: 2018-11-2
---

# 页面嵌入方式

常用的几种页面嵌入方式 

1. 使用iframe

2. 嵌入js代码

3. 其他 Flash、ActiveX控件（技术老旧、不适用H5）、$.load等嵌入html方式（只适用与html，不适用与canvas图表、样式也会相互影响）

## iframe嵌入

iframe嵌入是目前使用很广泛的一种嵌入方案

1. 实现过程

    iframe是HTML标准中用来嵌入页面的元素，嵌入实现过程比较简单，将iframe的src属性设置为需要嵌入的URL地址即可。然后和普通页面一样参数通过URL参数进行传递可以进行登录鉴权等访问控制。

2. 嵌入部分与主页面通信

    - 对于支持H5的现代浏览器，可以使用PostMessage接口通信，HTML5新增的window.postMessage, 是一种安全的,基于事件的消息API.
    - 对于老旧浏览器，有很多种方法创建与父页面同源的ifame、window.name、修改URL中hash部分等。

    不需要兼容老旧浏览器时，直接使用postMessage API就可以，需要兼容老旧浏览器时可以使用easyXDM，easyXDM是一个经过充分测试的JavaScript库，easyXDM集成了现有的多种跨域解决方案，针对不同浏览器可以适配最合适的方案，简化了跨域iframe之间的通信,并已经解决了所有的痛点。

3. 优缺点

    优势: 

    1. 浏览器直接打开页面基本一致，不需要进行额外开发
    2. 安全, 主页面和iframe的环境是隔离的互相不能直接访问，不存在脚本冲突，样式影响问题
    3. 获取云端数据不存在跨域访问
    

    劣势:

    1. iframe标签性能消耗较大，数量大于一定数量会造成页面卡顿
    2. 跨域iframe通信传递数据量较大时性能损失较大（数据传递时是复制）

## 嵌入js代码

嵌入js代码，类似于JQuery插件，使用时通过token等取出图表数据等信息，在指定的DOM元素内绘制图表

主要分为两种

1. 在服务端生成js代码

    服务端根据请求查询出数据，将数据和图表组件绘制部分代码整合到一起返回，浏览器执行js脚本代码,绘制图表

2. 直接引入静态js脚本

    图表组件绘制交互部分代码作为静态代码引入，根据参数查询数据绘制图表

两种方案对比: 
    在服务端生成js代码,所有的代码和数据都包含在生成的js文件中,不需要做额外的请求,适用于数据量较小的时候.大部分情况下第二种方案实现更加灵活.

与iframe相比优缺点

优点：

1. 不存在多个iframe的性能问题，多个图表可以公用一个图表绘制代码。
2. 可以直接使用主页面的数据

缺点：

1. 脚本冲突 如果主页面的也用了相同的库会不会脚本冲突，例如主页面也使用了vue开发（待验证） 
2. svg绘图时可能的样式影响
3. 请求数据跨域问题

## 总结

对于嵌入方式的选择一部分取决于准备以何种方式的嵌入。

以设计好的一个报告作为一个整体的嵌入，采用iframe方式会方便些，可以直接用分享页面一致的展示逻辑基本不需要修改，一个页面也很少嵌入很多的报告，这样iframe性能问题也不会成为瓶颈。

以单个图表作文嵌入的基本单位那么大部分页面都会嵌入很多，这样使用嵌入js代码会更合适些。